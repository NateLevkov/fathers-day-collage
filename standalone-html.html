<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Father's Day Collage Maker</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; 
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useCallback, useEffect } = React;
        const { Upload, Download, RotateCcw, Heart, Camera } = lucide;

        const FathersDayCollage = () => {
          const [images, setImages] = useState([]);
          const [collageGenerated, setCollageGenerated] = useState(false);
          const [isGenerating, setIsGenerating] = useState(false);
          const canvasRef = useRef(null);
          const downloadLinkRef = useRef(null);
          const fileInputRef = useRef(null);

          const handleImageUpload = useCallback((event) => {
            const files = Array.from(event.target.files);
            
            const loadPromises = files.map(file => {
              return new Promise((resolve) => {
                if (file.type.startsWith('image/')) {
                  const reader = new FileReader();
                  reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                      resolve({
                        id: Date.now() + Math.random(),
                        src: e.target.result,
                        file: file,
                        width: img.width,
                        height: img.height,
                        name: file.name
                      });
                    };
                    img.onerror = () => resolve(null);
                    img.src = e.target.result;
                  };
                  reader.onerror = () => resolve(null);
                  reader.readAsDataURL(file);
                } else {
                  resolve(null);
                }
              });
            });

            Promise.all(loadPromises).then(results => {
              const validImages = results.filter(img => img !== null);
              setImages(prev => [...prev, ...validImages]);
            });

            // Reset file input
            event.target.value = '';
          }, []);

          const generateCollageLayout = useCallback((imageCount) => {
            const layouts = {
              1: [{ x: 0, y: 0, width: 1, height: 1 }],
              2: [
                { x: 0, y: 0, width: 0.5, height: 1 },
                { x: 0.5, y: 0, width: 0.5, height: 1 }
              ],
              3: [
                { x: 0, y: 0, width: 0.5, height: 0.5 },
                { x: 0.5, y: 0, width: 0.5, height: 0.5 },
                { x: 0.25, y: 0.5, width: 0.5, height: 0.5 }
              ],
              4: [
                { x: 0, y: 0, width: 0.5, height: 0.5 },
                { x: 0.5, y: 0, width: 0.5, height: 0.5 },
                { x: 0, y: 0.5, width: 0.5, height: 0.5 },
                { x: 0.5, y: 0.5, width: 0.5, height: 0.5 }
              ],
              5: [
                { x: 0, y: 0, width: 0.4, height: 0.4 },
                { x: 0.6, y: 0, width: 0.4, height: 0.4 },
                { x: 0.3, y: 0.3, width: 0.4, height: 0.4 },
                { x: 0, y: 0.6, width: 0.4, height: 0.4 },
                { x: 0.6, y: 0.6, width: 0.4, height: 0.4 }
              ],
              6: [
                { x: 0, y: 0, width: 0.33, height: 0.5 },
                { x: 0.33, y: 0, width: 0.33, height: 0.5 },
                { x: 0.66, y: 0, width: 0.34, height: 0.5 },
                { x: 0, y: 0.5, width: 0.33, height: 0.5 },
                { x: 0.33, y: 0.5, width: 0.33, height: 0.5 },
                { x: 0.66, y: 0.5, width: 0.34, height: 0.5 }
              ]
            };

            if (imageCount > 6) {
              const cols = Math.ceil(Math.sqrt(imageCount));
              const rows = Math.ceil(imageCount / cols);
              const layout = [];
              
              for (let i = 0; i < imageCount; i++) {
                const col = i % cols;
                const row = Math.floor(i / cols);
                layout.push({
                  x: col / cols,
                  y: row / rows,
                  width: 1 / cols,
                  height: 1 / rows
                });
              }
              return layout;
            }

            return layouts[imageCount] || layouts[6];
          }, []);

          const generateCollage = useCallback(async () => {
            if (images.length === 0) return;

            setIsGenerating(true);
            setCollageGenerated(false);

            // Small delay to show loading state
            await new Promise(resolve => setTimeout(resolve, 100));

            const canvas = canvasRef.current;
            const ctx = canvas.getContext('2d');
            const canvasSize = 800;
            
            canvas.width = canvasSize;
            canvas.height = canvasSize;

            // Create gradient background
            const gradient = ctx.createLinearGradient(0, 0, canvasSize, canvasSize);
            gradient.addColorStop(0, '#4f46e5');
            gradient.addColorStop(0.5, '#7c3aed');
            gradient.addColorStop(1, '#db2777');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvasSize, canvasSize);

            // Add decorative border
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 8;
            ctx.strokeRect(20, 20, canvasSize - 40, canvasSize - 40);

            const layout = generateCollageLayout(images.length);
            const padding = 15;
            const borderRadius = 12;

            // Load and draw images
            const imagePromises = images.slice(0, layout.length).map((imageData, i) => {
              return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                  const pos = layout[i];
                  const x = pos.x * (canvasSize - 60) + 40;
                  const y = pos.y * (canvasSize - 60) + 40;
                  const width = pos.width * (canvasSize - 60) - padding;
                  const height = pos.height * (canvasSize - 60) - padding;

                  // Create rounded rectangle clipping path
                  ctx.save();
                  ctx.beginPath();
                  
                  // Manual rounded rectangle since roundRect might not be available in all browsers
                  const radius = Math.min(borderRadius, width / 2, height / 2);
                  ctx.moveTo(x + radius, y);
                  ctx.lineTo(x + width - radius, y);
                  ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
                  ctx.lineTo(x + width, y + height - radius);
                  ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                  ctx.lineTo(x + radius, y + height);
                  ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
                  ctx.lineTo(x, y + radius);
                  ctx.quadraticCurveTo(x, y, x + radius, y);
                  ctx.closePath();
                  ctx.clip();

                  // Calculate aspect ratio and draw image
                  const imgAspect = img.width / img.height;
                  const boxAspect = width / height;
                  
                  let drawWidth, drawHeight, drawX, drawY;
                  
                  if (imgAspect > boxAspect) {
                    drawHeight = height;
                    drawWidth = height * imgAspect;
                    drawX = x - (drawWidth - width) / 2;
                    drawY = y;
                  } else {
                    drawWidth = width;
                    drawHeight = width / imgAspect;
                    drawX = x;
                    drawY = y - (drawHeight - height) / 2;
                  }

                  ctx.drawImage(img, drawX, drawY, drawWidth, drawHeight);
                  ctx.restore();

                  // Add white border around image
                  ctx.strokeStyle = '#ffffff';
                  ctx.lineWidth = 3;
                  ctx.beginPath();
                  
                  // Draw border with same rounded rectangle
                  const borderRadius2 = Math.min(borderRadius, width / 2, height / 2);
                  ctx.moveTo(x + borderRadius2, y);
                  ctx.lineTo(x + width - borderRadius2, y);
                  ctx.quadraticCurveTo(x + width, y, x + width, y + borderRadius2);
                  ctx.lineTo(x + width, y + height - borderRadius2);
                  ctx.quadraticCurveTo(x + width, y + height, x + width - borderRadius2, y + height);
                  ctx.lineTo(x + borderRadius2, y + height);
                  ctx.quadraticCurveTo(x, y + height, x, y + height - borderRadius2);
                  ctx.lineTo(x, y + borderRadius2);
                  ctx.quadraticCurveTo(x, y, x + borderRadius2, y);
                  ctx.closePath();
                  ctx.stroke();

                  resolve();
                };
                img.onerror = resolve;
                img.src = imageData.src;
              });
            });

            // Wait for all images to be drawn
            await Promise.all(imagePromises);

            // Add Father's Day text
            ctx.font = 'bold 32px Arial';
            ctx.fillStyle = '#ffffff';
            ctx.textAlign = 'center';
            ctx.shadowColor = 'rgba(0,0,0,0.5)';
            ctx.shadowBlur = 4;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            
            const text = "Happy Father's Day!";
            const textY = canvasSize - 50;
            
            // Add background for text
            const textWidth = ctx.measureText(text).width;
            ctx.fillStyle = 'rgba(0,0,0,0.6)';
            ctx.fillRect(canvasSize/2 - textWidth/2 - 20, textY - 35, textWidth + 40, 50);
            
            ctx.fillStyle = '#ffffff';
            ctx.fillText(text, canvasSize / 2, textY);
            
            setIsGenerating(false);
            setCollageGenerated(true);
          }, [images, generateCollageLayout]);

          const downloadCollage = useCallback(() => {
            const canvas = canvasRef.current;
            const link = downloadLinkRef.current;
            
            canvas.toBlob((blob) => {
              const url = URL.createObjectURL(blob);
              link.href = url;
              link.download = `fathers-day-collage-${Date.now()}.png`;
              link.click();
              URL.revokeObjectURL(url);
            }, 'image/png');
          }, []);

          const resetCollage = useCallback(() => {
            setImages([]);
            setCollageGenerated(false);
            setIsGenerating(false);
            const canvas = canvasRef.current;
            if (canvas) {
              const ctx = canvas.getContext('2d');
              ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            if (fileInputRef.current) {
              fileInputRef.current.value = '';
            }
          }, []);

          const removeImage = useCallback((id) => {
            setImages(prev => prev.filter(img => img.id !== id));
            setCollageGenerated(false);
          }, []);

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-4 sm:p-6">
              <div className="max-w-4xl mx-auto">
                <div className="text-center mb-8">
                  <div className="flex items-center justify-center gap-3 mb-4">
                    <Heart className="w-6 h-6 sm:w-8 sm:h-8 text-red-500" />
                    <h1 className="text-2xl sm:text-4xl font-bold text-gray-800">Father's Day Collage Maker</h1>
                    <Camera className="w-6 h-6 sm:w-8 sm:h-8 text-blue-500" />
                  </div>
                  <p className="text-gray-600 text-base sm:text-lg">Create a beautiful photo collage for Dad's special day!</p>
                </div>

                <div className="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-6">
                  <div className="flex flex-col items-center">
                    <input
                      ref={fileInputRef}
                      type="file"
                      multiple
                      accept="image/*"
                      onChange={handleImageUpload}
                      className="hidden"
                      id="imageUpload"
                    />
                    <label
                      htmlFor="imageUpload"
                      className="flex items-center gap-2 bg-blue-500 hover:bg-blue-600 text-white px-4 sm:px-6 py-3 rounded-lg cursor-pointer transition-colors mb-4 text-sm sm:text-base"
                    >
                      <Upload className="w-4 h-4 sm:w-5 sm:h-5" />
                      Upload Photos
                    </label>
                    <p className="text-gray-500 text-xs sm:text-sm text-center">Select multiple images to create your collage</p>
                  </div>

                  {images.length > 0 && (
                    <div className="mt-6">
                      <h3 className="text-base sm:text-lg font-semibold mb-4">Uploaded Images ({images.length})</h3>
                      <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 sm:gap-4 mb-6">
                        {images.map((image) => (
                          <div key={image.id} className="relative group">
                            <img
                              src={image.src}
                              alt={image.name}
                              className="w-full h-16 sm:h-20 object-cover rounded-lg shadow-md"
                            />
                            <button
                              onClick={() => removeImage(image.id)}
                              className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center text-xs hover:bg-red-600 opacity-0 group-hover:opacity-100 transition-opacity"
                            >
                              ×
                            </button>
                          </div>
                        ))}
                      </div>

                      <div className="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center">
                        <button
                          onClick={generateCollage}
                          disabled={isGenerating}
                          className="bg-green-500 hover:bg-green-600 disabled:bg-green-300 text-white px-4 sm:px-6 py-3 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm sm:text-base"
                        >
                          <Camera className="w-4 h-4 sm:w-5 sm:h-5" />
                          {isGenerating ? 'Generating...' : 'Generate Collage'}
                        </button>
                        <button
                          onClick={resetCollage}
                          className="bg-gray-500 hover:bg-gray-600 text-white px-4 sm:px-6 py-3 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm sm:text-base"
                        >
                          <RotateCcw className="w-4 h-4 sm:w-5 sm:h-5" />
                          Reset
                        </button>
                      </div>
                    </div>
                  )}
                </div>

                {(images.length > 0 || collageGenerated || isGenerating) && (
                  <div className="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                    <h3 className="text-base sm:text-lg font-semibold mb-4 text-center">Your Father's Day Collage</h3>
                    
                    {isGenerating && (
                      <div className="flex flex-col items-center justify-center py-8">
                        <div className="loading-spinner"></div>
                        <p className="text-gray-600 mt-4">Creating your collage...</p>
                      </div>
                    )}
                    
                    <div className="flex justify-center mb-4">
                      <canvas
                        ref={canvasRef}
                        className="border-2 border-gray-200 rounded-lg shadow-md max-w-full h-auto"
                        style={{ maxWidth: '400px', display: isGenerating ? 'none' : 'block' }}
                      />
                    </div>
                    
                    {collageGenerated && (
                      <div className="text-center">
                        <button
                          onClick={downloadCollage}
                          className="bg-purple-500 hover:bg-purple-600 text-white px-4 sm:px-6 py-3 rounded-lg transition-colors flex items-center gap-2 mx-auto text-sm sm:text-base"
                        >
                          <Download className="w-4 h-4 sm:w-5 sm:h-5" />
                          Download Collage
                        </button>
                        <p className="text-gray-500 text-xs sm:text-sm mt-2">Your collage will be saved as a PNG file</p>
                      </div>
                    )}
                  </div>
                )}

                <a ref={downloadLinkRef} className="hidden" />
              </div>
            </div>
          );
        };

        // Render the app
        ReactDOM.render(React.createElement(FathersDayCollage), document.getElementById('root'));
    </script>
</body>
</html>